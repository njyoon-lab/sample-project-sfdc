pipeline {
    agent {
        docker {
            image 'njyoon/sfdc:latest' // Use your custom devhub container image
            // args '-u root:root' // Run as root to install CLI
        }
    }
    environment {
        MY_SECRET_FILE = credentials('SALESFORCE_SERVER_KEY')
        SF_USER = credentials('SF_CREDENTIALS')
        SF_CLIENT_ID = credentials('SF_CLIENT_ID')
    }
    stages {
        stage('Install Salesforce CLI') {
            steps {
                bash -c "sf --version"
            }
        }
        stage('Authenticate to Salesforce Org') {
            steps {
                bash <<EOF
                sf org login jwt --client-id "$SF_CLIENT_ID_USR" \
                    --jwt-key-file "$MY_SECRET_FILE" \
                    --username "$SF_USER_USR" \
                    --instance-url "${SFDC_ENV}" \
                    --alias my-hub-org --set-default-dev-hub
                EOF
            }
        }
        stage('Docker Build') {
            steps {
                echo "Building Docker image..."
            }
        }
    }
}