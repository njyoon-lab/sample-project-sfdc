pipeline {
    agent {
        dockerfile {
            filename 'Dockerfile' // Uses Dockerfile in the root of the repo
            dir '.' // Build context is the current directory
            additionalBuildArgs ''
        }
    }
    environment {
        MY_SECRET_FILE = credentials('SALESFORCE_SERVER_KEY')
        SF_USER = credentials('SF_CREDENTIALS')
        SF_CLIENT_ID = credentials('SF_CLIENT_ID')
    }
    stages {
        stage('Install Salesforce CLI') {
            steps {
                sh 'sf --version'
            }
        }
        stage('Authenticate to Salesforce Org') {
            steps {
                sh '''
                   sf org login jwt --client-id ${SF_CLIENT_ID_USR} \
                   --jwt-key-file ${MY_SECRET_FILE} --username ${SF_USER_USR} \
                   --instance-url ${env.SFDC_ENV} --alias my-hub-org --set-default-dev-hub
                '''
            }
        }
        stage('Docker Build') {
            steps {
                sh 'echo "Building Docker image..."'
            }
        }
    }
}